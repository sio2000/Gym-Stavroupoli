import{u as R,r as m,j as e,v as M,b as q,q as v,E as c,e as _}from"./index-CFMUBE6X.js";import{s as G,a as H,c as X,d as Z,e as J,f as K}from"./pilatesScheduleApi-CT7TZWOE.js";import{C as Q,a as V}from"./chevron-right-B1ZLNb5D.js";const te=()=>{const{user:a}=R(),[k,B]=m.useState([]),[W,T]=m.useState([]),[A,w]=m.useState(!0),[j,O]=m.useState(0),[d,D]=m.useState(()=>{const s=new Date("2025-09-13T00:00:00.000Z");return console.log("User: Using admin week - 13 Sep:",s.toISOString()),s}),P=()=>{const s=[],t=new Date(d);console.log("User: getWeekDates - currentWeek:",t);for(let r=0;r<14;r++){const n=new Date(t);n.setDate(t.getDate()+r),s.push(n),console.log(`User: Day ${r}: ${n.toISOString().split("T")[0]}`)}return s},$=()=>{const s=[];for(let t=8;t<=21;t++)s.push(`${t.toString().padStart(2,"0")}:00`);return s},y=s=>{const t=["ÎšÏ…Ï","Î”ÎµÏ…","Î¤ÏÎ¹","Î¤ÎµÏ„","Î ÎµÎ¼","Î Î±Ï","Î£Î±Î²"],r=["Î™Î±Î½","Î¦ÎµÎ²","ÎœÎ±Ï","Î‘Ï€Ï","ÎœÎ±Î¹","Î™Î¿Ï…Î½","Î™Î¿Ï…Î»","Î‘Ï…Î³","Î£ÎµÏ€","ÎŸÎºÏ„","ÎÎ¿Îµ","Î”ÎµÎº"],n=t[s.getDay()],x=s.getDate(),i=r[s.getMonth()];return`${n} ${x} ${i}`},E=s=>{const t=s.getDay();return t===0||t===6},I=(s,t)=>k.filter(r=>r.date===s&&r.start_time===t+":00"),z=(s,t)=>k.some(r=>r.date===s&&r.start_time===t+":00"),S=s=>W.some(t=>t.slot_id===s&&t.status==="confirmed"),b=async()=>{if(a!=null&&a.id)try{w(!0),console.log("=== LOADING PILATES CALENDAR DATA ===");const s=new Date(d).toISOString().split("T")[0],t=new Date(d);t.setDate(t.getDate()+13);const r=t.toISOString().split("T")[0],[n,x,i]=await Promise.all([H(s,r),X(a.id),Z(a.id)]);console.log("Fetched slots from DB:",n.length),console.log("Fetched bookings from DB:",x.length);const o=n.map(l=>({...l,available_capacity:Math.max(0,l.max_capacity-l.booked_count)}));B(o),T(x),O((i==null?void 0:i.deposit_remaining)||0)}catch(s){console.error("Error loading data:",s),c.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½")}finally{w(!1)}},C=s=>{const t=new Date(d);s==="prev"?t.setDate(t.getDate()-14):t.setDate(t.getDate()+14),D(t),console.log("Navigated to week:",t)},U=async s=>{if(a!=null&&a.id){if(!s.is_active){c.error("Î‘Ï…Ï„ÏŒ Ï„Î¿ Î¼Î¬Î¸Î·Î¼Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿.");return}if(S(s.id)){c.error("ÎˆÏ‡ÎµÏ„Îµ Î®Î´Î· ÎºÎ»ÎµÎ¯ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼Î¬Î¸Î·Î¼Î±.");return}try{if(console.log("Booking slot:",s),j<=0){c.error("Î¤Î± Î¼Î±Î¸Î®Î¼Î±Ï„Î¬ ÏƒÎ±Ï‚ Ï„ÎµÎ»ÎµÎ¯Ï‰ÏƒÎ±Î½. Î“Î¹Î± Î±Î½Î±Î½Î­Ï‰ÏƒÎ·, Î±Ï€ÎµÏ…Î¸Ï…Î½Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î· ÏÎµÏƒÎµÏˆÎ¹ÏŒÎ½.");return}if(s.booked_count>=s.max_capacity){c.error("Î¤Î¿ Î¼Î¬Î¸Î·Î¼Î± ÎµÎ¯Î½Î±Î¹ Ï€Î»Î®ÏÎµÏ‚.");return}const t=await J({slotId:s.id,notes:""},a.id);console.log("Booking created:",t),c.success("Î¤Î¿ Î¼Î¬Î¸Î·Î¼Î± ÎºÎ»ÎµÎ¯ÏƒÏ„Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!"),await b()}catch(t){console.error("Error booking slot:",t),c.error("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎºÏÎ¬Ï„Î·ÏƒÎ· Ï„Î¿Ï… Î¼Î±Î¸Î®Î¼Î±Ï„Î¿Ï‚.")}}},F=async s=>{if(a!=null&&a.id)try{console.log("Cancelling booking for slot:",s),await K(s),c.success("Î— ÎºÏÎ¬Ï„Î·ÏƒÎ· Î±ÎºÏ…ÏÏÎ¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!"),await b()}catch(t){console.error("Error cancelling booking:",t),c.error("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±ÎºÏÏÏ‰ÏƒÎ· Ï„Î·Ï‚ ÎºÏÎ¬Ï„Î·ÏƒÎ·Ï‚.")}};m.useEffect(()=>{console.log("User: useEffect triggered - currentWeek changed to:",d.toISOString()),b();const s=G(()=>{b()});return()=>{try{s.unsubscribe()}catch{}}},[a==null?void 0:a.id,d]);const p=P(),L=$();return A?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"animate-spin text-primary mx-auto mb-4",size:48}),e.jsx("p",{className:"text-lg text-gray-600",children:"Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center",children:[e.jsx(q,{className:"mr-3 text-primary",size:32}),"Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Pilates"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"ÎšÎ»ÎµÎ¯ÏƒÏ„Îµ Î¼Î±Î¸Î®Î¼Î±Ï„Î± pilates Î³Î¹Î± Ï„Î¹Ï‚ ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ 2 ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>C("prev"),className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(Q,{size:20,className:"mr-2"}),"Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î·"]}),e.jsx("button",{onClick:()=>{const s=new Date,t=s.getDay(),r=new Date(s),n=t===0?-6:1-t;r.setDate(s.getDate()+n),r.setHours(0,0,0,0),D(r),console.log("User: Force refreshed currentWeek to:",r.toISOString())},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"ğŸ”„ Refresh"})]}),e.jsx("div",{className:"text-center",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["2 ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚: ",y(p[0])," - ",y(p[13])]})}),e.jsxs("button",{onClick:()=>C("next"),className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:["Î•Ï€ÏŒÎ¼ÎµÎ½Î·",e.jsx(V,{size:20,className:"ml-2"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-blue-800 text-sm",children:[e.jsx("strong",{children:"ÎŸÎ´Î·Î³Î¯ÎµÏ‚:"})," ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î± Ï€ÏÎ¬ÏƒÎ¹Î½Î± Î¼Î±Î¸Î®Î¼Î±Ï„Î± Î³Î¹Î± Î½Î± ÎºÎ»ÎµÎ¯ÏƒÎµÏ„Îµ ÎºÏÎ¬Ï„Î·ÏƒÎ·. Î¤Î± ÎºÏŒÎºÎºÎ¹Î½Î± Î¼Î±Î¸Î®Î¼Î±Ï„Î± ÎµÎ¯Î½Î±Î¹ Î±ÎºÏ…ÏÏ‰Î¼Î­Î½Î± Î±Ï€ÏŒ Ï„Î¿Î½ admin. Î¤Î± Î¼Ï€Î»Îµ Î¼Î±Î¸Î®Î¼Î±Ï„Î± ÎµÎ¯Î½Î±Î¹ Î®Î´Î· ÎºÏÎ±Ï„Î·Î¼Î­Î½Î± Î±Ï€ÏŒ ÎµÏƒÎ¬Ï‚."]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4 border",children:[e.jsxs("p",{className:"text-lg font-semibold",children:["Pilates deposit: ",j," Î¼Î±Î¸Î®Î¼Î±Ï„Î± Î±Ï€Î¿Î¼Î­Î½Î¿Ï…Î½"]}),j<=0&&e.jsx("p",{className:"text-red-600 mt-1",children:"Î¤Î± Î¼Î±Î¸Î®Î¼Î±Ï„Î¬ ÏƒÎ±Ï‚ Ï„ÎµÎ»ÎµÎ¯Ï‰ÏƒÎ±Î½. Î“Î¹Î± Î±Î½Î±Î½Î­Ï‰ÏƒÎ·, Î±Ï€ÎµÏ…Î¸Ï…Î½Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î· ÏÎµÏƒÎµÏˆÎ¹ÏŒÎ½."})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 w-20",children:"ÎÏÎ±"}),p.map(s=>e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-700 min-w-32",children:y(s)},s.toISOString()))]})}),e.jsx("tbody",{children:L.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-700",children:s}),p.map(t=>{const r=t.toISOString().split("T")[0],n=I(r,s),x=E(t),i=z(r,s);return e.jsx("td",{className:"px-4 py-3 text-center",children:x?e.jsx("div",{className:"text-gray-400 text-xs",children:"Î£Î±Î²/ÎšÏ…Ï"}):i?e.jsx("div",{className:"space-y-1",children:n.map(o=>{const l=S(o.id),f=o.is_active,N=o.booked_count>=o.max_capacity;let g="",h=null,u="";return l?(g="bg-blue-100 text-blue-800 border-blue-200",h=e.jsx(_,{size:16,className:"text-blue-600"}),u="ÎšÏÎ±Ï„Î·Î¼Î­Î½Î¿"):f&&!N?(g="bg-green-100 text-green-800 border-green-200 hover:bg-green-200 cursor-pointer",h=e.jsx(_,{size:16,className:"text-green-600"}),u=`${o.booked_count}/${o.max_capacity}`):f&&N?(g="bg-red-100 text-red-800 border-red-200 cursor-not-allowed",h=e.jsx(v,{size:16,className:"text-red-600"}),u="Î Î»Î®ÏÎµÏ‚"):(g="bg-red-100 text-red-800 border-red-200 cursor-not-allowed",h=e.jsx(v,{size:16,className:"text-red-600"}),u="Î‘ÎºÏ…ÏÏ‰Î¼Î­Î½Î¿"),e.jsx("div",{className:`px-3 py-2 rounded-lg border text-xs font-medium transition-colors ${g}`,onClick:()=>{f&&!l&&!N?U(o):l&&F(o.id)},children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[h,e.jsx("span",{children:u})]})},o.id)})}):e.jsx("div",{className:"bg-red-100 text-red-800 border-red-200 px-3 py-2 rounded-lg text-xs font-medium cursor-not-allowed",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(v,{size:16,className:"text-red-600"}),e.jsx("span",{children:"ÎœÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿"})]})})},`${r}-${s}`)})]},s))})]})})}),e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Î•Î¾Î®Î³Î·ÏƒÎ· Ï‡ÏÏ‰Î¼Î¬Ï„Ï‰Î½"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î³Î¹Î± ÎºÏÎ¬Ï„Î·ÏƒÎ·"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 border border-blue-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"ÎšÏÎ±Ï„Î·Î¼Î­Î½Î¿ Î±Ï€ÏŒ ÎµÏƒÎ¬Ï‚"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Î Î»Î®ÏÎµÏ‚/Î‘ÎºÏ…ÏÏ‰Î¼Î­Î½Î¿"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"ÎœÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿"})]})]})]})]})})};export{te as default};
