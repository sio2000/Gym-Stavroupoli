import{d as te,u as ae,r as d,j as e,x as re,b as ne,p as $,v as w,F as i,e as P}from"./index-DXc16WYz.js";import{s as oe,a as le,c as ie,d as ce,e as de,f as me}from"./pilatesScheduleApi-Dt0AYZTo.js";import{g as xe,t as A,C as M,b as T,a as ge,p as F}from"./date-1PgwZpeN.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=te("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),ye=()=>{var W;const{user:r}=ae(),[C,L]=d.useState([]),[U,O]=d.useState([]),[I,S]=d.useState(!0),[k,G]=d.useState(0),[H,z]=d.useState(!1),[h,E]=d.useState(null),[j,K]=d.useState(()=>{const s=xe();return console.log("🔥🔥🔥 USER FORCE REFRESH: Using NEW Greek Monday function - Monday:",s.toISOString(),"TIMESTAMP:",Date.now()),console.log("🔥🔥🔥 USER FORCE REFRESH: Day of week (should be 1 for Monday):",s.getUTCDay()),s}),_=()=>{const s=[],t=new Date(j);console.log("User: getWeekDates - currentWeek:",t);for(let a=0;a<14;a++){const c=ge(t,a),l=A(c);s.push(l),console.log(`User: Day ${a}: ${l}`)}return s},q=()=>{const s=[];for(let t=8;t<=21;t++)s.push(`${t.toString().padStart(2,"0")}:00`);return s},u=s=>{const t=F(s),a=["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"],c=["Ιαν","Φεβ","Μαρ","Απρ","Μαι","Ιουν","Ιουλ","Αυγ","Σεπ","Οκτ","Νοε","Δεκ"],l=a[t.getDay()],m=t.getDate(),n=c[t.getMonth()];return`${l} ${m} ${n}`},V=s=>{const a=F(s).getDay();return a===0||a===6},X=(s,t)=>C.filter(a=>a.date===s&&a.start_time===t+":00"),J=(s,t)=>C.some(a=>a.date===s&&a.start_time===t+":00"),B=s=>U.some(t=>t.slot_id===s&&t.status==="confirmed"),N=async()=>{if(r!=null&&r.id)try{S(!0),console.log("=== LOADING PILATES CALENDAR DATA ===");const s=_(),t=s[0],a=s[13],[c,l,m]=await Promise.all([le(t,a),ie(r.id),ce(r.id)]);console.log("Fetched slots from DB:",c.length),console.log("Fetched bookings from DB:",l.length);const n=c.map(o=>({...o,available_capacity:Math.max(0,o.max_capacity-o.booked_count)}));L(n),O(l),G((m==null?void 0:m.deposit_remaining)||0)}catch(s){console.error("Error loading data:",s),i.error("Σφάλμα φόρτωσης δεδομένων")}finally{S(!1)}},v=s=>{const t=new Date(j);s==="prev"?t.setDate(t.getDate()-14):t.setDate(t.getDate()+14),K(t),console.log("Navigated to week:",t)},Q=async s=>{if(r!=null&&r.id){if(!s.is_active){i.error("Αυτό το μάθημα δεν είναι διαθέσιμο.");return}if(B(s.id)){i.error("Έχετε ήδη κλείσει αυτό το μάθημα.");return}try{if(console.log("Booking slot:",s),k<=0){i.error("Τα μαθήματά σας τελείωσαν. Για ανανέωση, απευθυνθείτε στη ρεσεψιόν.");return}if(s.booked_count>=s.max_capacity){i.error("Το μάθημα είναι πλήρες.");return}const t=await me({slotId:s.id,notes:""},r.id);console.log("Booking created:",t),i.success("Το μάθημα κλείστηκε επιτυχώς!"),await N()}catch(t){console.error("Error booking slot:",t),i.error("Σφάλμα κατά την κράτηση του μαθήματος.")}}},Y=async s=>{if(r!=null&&r.id)try{console.log("Cancelling booking for slot:",s),await de(s),i.success("Η κράτηση ακυρώθηκε επιτυχώς!"),await N()}catch(t){console.error("Error cancelling booking:",t),i.error("Σφάλμα κατά την ακύρωση της κράτησης.")}};d.useEffect(()=>{console.log("User: useEffect triggered - currentWeek changed to:",j.toISOString()),N();const s=oe(()=>{console.log("🔥🔥🔥 USER: Realtime update received - reloading data"),N()});return()=>{try{s.unsubscribe()}catch{}}},[r==null?void 0:r.id,j]);const g=_(),Z=q(),R=A(new Date),ee=s=>{E(s),z(!0)},D=()=>{z(!1),E(null)},se=async()=>{h&&(await Q(h),D())};return I?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:"animate-spin text-primary mx-auto mb-4",size:48}),e.jsx("p",{className:"text-lg text-gray-600",children:"Φόρτωση προγράμματος..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 md:px-6 py-4 md:py-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 sm:p-5 md:p-6 mb-4 md:mb-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-0 mb-3 md:mb-4",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 flex items-center flex-wrap",children:[e.jsx(ne,{className:"mr-2 sm:mr-3 text-primary",size:28}),"Ημερολόγιο Pilates",e.jsx($,{className:"ml-2 sm:ml-3 text-amber-500",size:20})]}),e.jsx("p",{className:"text-gray-600 mt-1 sm:mt-2 text-sm sm:text-base",children:"Κλείστε μαθήματα pilates για τις επόμενες 2 εβδομάδες"})]})}),e.jsxs("div",{className:"hidden sm:grid grid-cols-[auto,1fr,auto] items-center gap-1.5 sm:gap-3 mb-3 sm:mb-4",children:[e.jsx("div",{className:"flex items-center gap-1.5 py-1 min-w-0",children:e.jsxs("button",{onClick:()=>v("prev"),className:"flex items-center px-2 sm:px-3 py-1.5 sm:py-2 text-[12px] sm:text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors whitespace-nowrap",children:[e.jsx(M,{size:16,className:"mr-1.5"}),"Προηγούμενη"]})}),e.jsx("div",{className:"text-center min-w-0",children:e.jsxs("h2",{className:"text-xs sm:text-xl font-semibold text-gray-800 truncate",children:["2 εβδομάδες: ",u(g[0])," - ",u(g[13])]})}),e.jsxs("button",{onClick:()=>v("next"),className:"flex items-center px-2 sm:px-3 py-1.5 sm:py-2 text-[12px] sm:text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors whitespace-nowrap",children:["Επόμενη",e.jsx(T,{size:16,className:"ml-1.5"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 mb-4 md:mb-6",children:e.jsxs("p",{className:"text-blue-800 text-xs sm:text-sm leading-relaxed",children:[e.jsx("strong",{children:"Οδηγίες:"})," Κάντε κλικ στα πράσινα μαθήματα για να κλείσετε κράτηση. Τα κόκκινα μαθήματα είναι ακυρωμένα από τον admin. Τα μπλε μαθήματα είναι ήδη κρατημένα από εσάς."]})}),e.jsxs("div",{className:"rounded-xl p-4 sm:p-5 mb-4 border bg-gradient-to-r from-pink-50 to-rose-50 border-rose-200",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-3 inline-flex h-9 w-9 sm:h-10 sm:w-10 items-center justify-center rounded-full bg-white border border-rose-200 shadow-sm",children:e.jsx(be,{className:"text-rose-500",size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-rose-700",children:"Υπόλοιπο Pilates"}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-rose-800",children:[k," μαθήματα απομένουν"]})]})]}),e.jsxs("span",{className:"shrink-0 inline-flex items-center rounded-full bg-white text-rose-700 border border-rose-200 px-2.5 sm:px-3 py-1 text-[11px] sm:text-xs font-semibold shadow-sm",children:[e.jsx($,{className:"mr-1",size:12})," Κράτα το ρυθμό!"]})]}),k<=0&&e.jsx("p",{className:"text-red-600 mt-3 text-xs sm:text-sm",children:"Τα μαθήματά σας τελείωσαν. Για ανανέωση, απευθυνθείτε στη ρεσεψιόν."})]})]}),e.jsxs("div",{className:"sm:hidden mb-3",children:[e.jsx("div",{className:"text-center mb-2",children:e.jsxs("div",{className:"inline-block px-3 py-1 rounded-full bg-gray-100 text-gray-800 text-xs font-semibold",children:["2 εβδομάδες: ",u(g[0])," - ",u(g[13])]})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>v("prev"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm text-white bg-blue-600 border border-blue-600 rounded-lg shadow-sm hover:bg-blue-700 active:scale-[0.99]","aria-label":"Προηγούμενη εβδομάδα",children:[e.jsx(M,{size:16}),"Προηγούμενη"]}),e.jsxs("button",{onClick:()=>v("next"),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-sm text-white bg-blue-600 border border-blue-600 rounded-lg shadow-sm hover:bg-blue-700 active:scale-[0.99]","aria-label":"Επόμενη εβδομάδα",children:["Επόμενη",e.jsx(T,{size:16})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"sm:hidden text-xs text-gray-500 px-3 pt-3",children:"Σύρετε οριζόντια για να δείτε όλες τις ημέρες"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-[10px] sm:text-xs md:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b sticky top-0 z-20",children:[e.jsx("th",{className:"px-3 sm:px-4 py-2 sm:py-3 text-left font-medium text-gray-700 w-16 sm:w-20 sticky left-0 bg-gray-50 z-30 border-r border-gray-200",children:"Ώρα"}),g.map(s=>{const t=s===R;return e.jsxs("th",{className:`px-3 sm:px-4 py-2 sm:py-3 text-center font-semibold min-w-[5.25rem] sm:min-w-32 ${t?"bg-blue-50 text-blue-800":"text-gray-700"}`,title:t?"Σήμερα":void 0,children:[u(s),t&&e.jsx("span",{className:"ml-1.5 sm:ml-2 inline-block px-1.5 sm:px-2 py-0.5 text-[9px] sm:text-[10px] rounded-full bg-blue-100 text-blue-700 align-middle",children:"Σήμερα"})]},s)})]})}),e.jsx("tbody",{children:Z.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 sm:px-4 py-2 sm:py-3 font-medium text-gray-700 sticky left-0 bg-white z-10 border-r border-gray-100",children:s}),g.map(t=>{const a=X(t,s),c=V(t),l=J(t,s),m=t===R;return e.jsx("td",{className:`px-2.5 sm:px-4 py-1.5 sm:py-3 text-center align-middle ${m?"bg-blue-50/40":""}`,children:c?e.jsx("div",{className:"text-gray-400 text-[10px] sm:text-xs",children:"Σαβ/Κυρ"}):l?e.jsx("div",{className:"space-y-1",children:a.map(n=>{const o=B(n.id),b=n.is_active,p=n.booked_count>=n.max_capacity;let y="",f=null,x="";return o?(y="bg-blue-100 text-blue-800 border-blue-200 hover:bg-blue-200",f=e.jsx(P,{size:12,className:"text-blue-600"}),x="Κρατημένο"):b&&!p?(y="bg-green-100 text-green-800 border-green-200 hover:bg-green-200 cursor-pointer",f=e.jsx(P,{size:12,className:"text-green-600"}),x=`${n.booked_count}/${n.max_capacity}`):b&&p?(y="bg-rose-50 text-rose-700 border-rose-200 cursor-not-allowed",f=e.jsx(w,{size:12,className:"text-rose-600"}),x="Πλήρες"):(y="bg-rose-50 text-rose-700 border-rose-200 cursor-not-allowed",f=e.jsx(w,{size:12,className:"text-rose-600"}),x="Ακυρωμένο"),e.jsx("button",{type:"button","aria-label":o?"Ακύρωση κράτησης":b&&!p?"Κλείσιμο μαθήματος":x,title:o?"Κάντε κλικ για ακύρωση":b&&!p?"Κάντε κλικ για κράτηση":x,className:`px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg border text-[10px] sm:text-xs font-medium transition-colors transition-transform focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 ${y} ${b&&!o&&!p?"hover:scale-[1.02]":""}`,onClick:()=>{b&&!o&&!p?ee(n):o&&Y(n.id)},children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[f,e.jsx("span",{children:x})]})},n.id)})}):e.jsx("div",{className:"bg-red-100 text-red-800 border-red-200 px-2.5 sm:px-3 py-1.5 sm:py-2 rounded-lg text-[10px] sm:text-xs font-medium cursor-not-allowed",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(w,{size:12,className:"text-red-600"}),e.jsx("span",{children:"Μη διαθέσιμο"})]})})},`${t}-${s}`)})]},s))})]})})]}),e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Εξήγηση χρωμάτων"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Διαθέσιμο για κράτηση"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 border border-blue-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Κρατημένο από εσάς"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-rose-50 border border-rose-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Πλήρες/Ακυρωμένο"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 bg-neutral-100 border border-neutral-200 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Μη διαθέσιμο"})]})]})]}),H&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:D}),e.jsxs("div",{className:"relative bg-white w-full sm:w-[90%] max-w-md rounded-t-2xl sm:rounded-xl shadow-lg border p-5 sm:p-6 animate-in fade-in slide-in-from-bottom-4 sm:zoom-in",children:[e.jsxs("h4",{id:"confirm-title",className:"text-base sm:text-lg font-semibold text-gray-800 flex items-center",children:[e.jsx(w,{size:18,className:"text-rose-600 mr-2"})," Επιβεβαίωση κράτησης"]}),e.jsx("p",{id:"confirm-desc",className:"text-sm text-gray-700 mt-2 sm:mt-3",children:"Αν προχωρήσετε σε κράτηση, δεν θα μπορείτε να ακυρώσετε το μάθημα μετά."}),h&&e.jsxs("div",{className:"mt-3 sm:mt-4 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-800",children:"Ημερομηνία:"})," ",h.date,e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Ώρα:"})," ",(W=h.start_time)==null?void 0:W.slice(0,5)]}),e.jsxs("div",{className:"mt-5 sm:mt-6 flex items-center justify-end gap-2 sm:gap-3",children:[e.jsx("button",{type:"button",onClick:D,className:"px-3 sm:px-4 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:"Ακύρωση"}),e.jsx("button",{type:"button",onClick:se,className:"px-3 sm:px-4 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700 transition-colors",children:"Επιβεβαίωση"})]})]})]})]})})};export{ye as default};
