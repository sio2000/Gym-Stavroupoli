import{r as i,z as j,j as e,m as L,X as z,C as I,M as U,o as Y,s as O}from"./index-D1F5Dm1t.js";import{getGroupTrainingCalendarEvents as q}from"./groupTrainingCalendarApi-CPHiZ7y6.js";import{C as B,a as K}from"./chevron-right-DwW40yBp.js";import{R as W}from"./refresh-cw-Dn7fOdWs.js";const V=({featureEnabled:x=!0})=>{const[m,n]=i.useState(()=>new Date),[p,h]=i.useState([]),[g,u]=i.useState(!1),[a,_]=i.useState(null),[S,v]=i.useState(!1),[N,w]=i.useState(!1),o=m.getMonth()+1,d=m.getFullYear(),f=i.useCallback(async()=>{if(x){u(!0);try{const s=`${d}-${o.toString().padStart(2,"0")}-01`,t=new Date(d,o,0).toISOString().split("T")[0];console.log("[GroupTrainingCalendar] Loading events for:",{startDate:s,endDate:t});const r=await q(s,t);h(r.events),console.log("[GroupTrainingCalendar] Loaded events:",r.events.length)}catch(s){console.error("[GroupTrainingCalendar] Error loading events:",s),j.error("Αποτυχία φόρτωσης ημερολογίου")}finally{u(!1)}}},[d,o,x]);i.useEffect(()=>{f()},[f]);const D=()=>{n(s=>new Date(s.getFullYear(),s.getMonth()-1,1))},T=()=>{n(s=>new Date(s.getFullYear(),s.getMonth()+1,1))},k=()=>{n(new Date)},E=s=>{const t=s.toISOString().split("T")[0];return p.filter(r=>r.start.startsWith(t))},M=(s,t)=>{const r=s/t*100;return r===0?"text-gray-600":r<=50?"text-green-700":r<100?"text-yellow-700":"text-red-700"},C=(s,t)=>{const r=s/t*100;return r===0?"bg-gray-100":r<=50?"bg-green-200":r<100?"bg-yellow-200":"bg-red-200"},y=(s,t)=>s>=t,G=async s=>{try{u(!0),console.log("[GroupTrainingCalendar] Event clicked:",s);const t=s.id.replace("group-","");console.log("[GroupTrainingCalendar] Event key:",t),_(s),v(!0)}catch(t){console.error("[GroupTrainingCalendar] Error loading event details:",t),j.error("Failed to load event details")}finally{u(!1)}},$=async()=>{w(!0);try{await f(),j.success("Ημερολόγιο ανανεώθηκε")}catch(s){console.error("[GroupTrainingCalendar] Error refreshing:",s),j.error("Αποτυχία ανανέωσης ημερολογίου")}finally{w(!1)}},A=()=>{const s=new Date(d,o,0).getDate(),t=new Date(d,o-1,1).getDay(),r=[];for(let c=0;c<t;c++)r.push(e.jsx("div",{className:"min-h-32 bg-gray-50 rounded-lg"},`empty-${c}`));for(let c=1;c<=s;c++){const F=new Date(d,o-1,c),b=E(F);r.push(e.jsxs("div",{className:"min-h-32 bg-white border border-gray-200 rounded-lg p-2 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:c}),b.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:b.length})]}),e.jsx("div",{className:"space-y-1 flex-grow",children:b.map((l,P)=>{const R=y(l.participants_count,l.capacity);return e.jsx("div",{onClick:()=>G(l),className:`rounded-lg cursor-pointer hover:opacity-90 transition-all duration-200 ${C(l.participants_count,l.capacity)} border border-opacity-20 shadow-sm hover:shadow-md p-2`,title:"Click to view session details",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-sm text-gray-800 mb-1",children:l.start.split("T")[1].substring(0,5)}),e.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[e.jsx("span",{className:"text-lg",children:l.capacity===1?"👤":l.capacity===2?"👥👥":l.capacity===3?"👥👥👥":l.capacity===6?"👥👥👥👥👥👥":"👥"}),e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:[l.participants_count,"/",l.capacity]})]}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:l.capacity===1?"1 άτομο (Individual)":l.capacity===2?"2 άτομα":l.capacity===3?"3 άτομα":l.capacity===6?"6 άτομα":`${l.capacity} άτομα`}),R&&e.jsx("div",{className:"text-xs text-red-600 font-bold mt-1",children:"🔒 ΓΕΜΑΤΟ"})]})},P)})})]},c))}return r};return x?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx("span",{className:"text-blue-600",children:"📅"}),e.jsx("span",{children:"Κλεισμένες Ομαδικές Σεσίες"})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Μηνιαία προβολή -"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Ελεύθερα"})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Μισά"})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Γεμάτα"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:g,children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx("button",{onClick:k,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:g,children:"Σήμερα"}),e.jsxs("button",{onClick:$,className:"px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-1",disabled:g||N,children:[N?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Ανανέωση"})]}),e.jsx("button",{onClick:T,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:g,children:e.jsx(K,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:new Date(d,o-1).toLocaleDateString("en-US",{month:"long",year:"numeric"})})})]}),e.jsx("div",{className:"p-4 sm:p-6",children:g?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading calendar events..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"].map(s=>e.jsx("div",{className:"text-center text-sm font-bold text-gray-700 py-3 bg-gray-100 rounded-lg",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-2 auto-rows-min",children:A()})]})}),S&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Λεπτομέρειες Σεσίας"}),e.jsx("button",{onClick:()=>v(!1),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(I,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"font-medium",children:[new Date(a.start).toLocaleDateString("el-GR")," στις ",a.start.split("T")[1].substring(0,5)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(U,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:a.room})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{children:["Προπονητής: ",a.trainer]})]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${y(a.participants_count,a.capacity)?"bg-red-50 border border-red-200":"bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-medium text-lg",children:"Χωρητικότητα Μαθήματος"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:a.capacity===1?"👤":a.capacity===2?"👥👥":a.capacity===3?"👥👥👥":a.capacity===6?"👥👥👥👥👥👥":"👥"}),e.jsxs("span",{className:`px-3 py-2 rounded-full text-lg font-bold ${C(a.participants_count,a.capacity)} ${M(a.participants_count,a.capacity)}`,children:[a.participants_count,"/",a.capacity]}),y(a.participants_count,a.capacity)&&e.jsx("span",{className:"text-sm text-red-600 font-bold bg-red-100 px-3 py-2 rounded-lg",children:"🔒 ΓΕΜΑΤΟ"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800 mb-2",children:a.capacity===1?"Individual Training - 1 άτομο":a.capacity===2?"Μάθημα για 2 άτομα":a.capacity===3?"Μάθημα για 3 άτομα":a.capacity===6?"Μάθημα για 6 άτομα":`Μάθημα για ${a.capacity} άτομα`}),e.jsx("div",{className:"text-sm text-gray-600",children:a.participants_count===0?"Κανένας συμμετέχων":a.participants_count===1?"1 συμμετέχων":`${a.participants_count} συμμετέχοντες`})]}),y(a.participants_count,a.capacity)&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-100 p-3 rounded-lg",children:"⚠️ Αυτό το μάθημα είναι γεμάτο. Δεν επιτρέπονται νέες κρατήσεις."})]}),a.participants.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Συμμετέχοντες"}),e.jsx("div",{className:"space-y-2",children:a.participants.map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:s.name.split(" ").map(r=>r[0]).join("").toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-gray-600",children:s.email})]})]},t))})]})]})]})})})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"Το Ημερολόγιο Ομαδικής Προπόνησης είναι απενεργοποιημένο"})]})})},Z=async(x,m,n)=>{try{console.log("[saveProgramApprovalState] Saving approval state:",{userId:x,approvalStatus:m,options:n});const{data:p,error:h}=await O.from("program_approval_states").insert({user_id:x,program_id:n.programId,approval_status:m,old_members_used:n.oldMembersUsed||!1,kettlebell_points:n.kettlebellPoints||0,cash_amount:n.cashAmount||0,pos_amount:n.posAmount||0,created_by:n.createdBy,notes:n.notes,group_room_size:n.groupRoomSize,weekly_frequency:n.weeklyFrequency,monthly_total:n.monthlyTotal}).select().single();return h?(console.error("[saveProgramApprovalState] Error saving approval state:",h),!1):(console.log("[saveProgramApprovalState] Approval state saved successfully:",p),!0)}catch(p){return console.error("[saveProgramApprovalState] Exception saving approval state:",p),!1}};export{V as G,Z as s};
