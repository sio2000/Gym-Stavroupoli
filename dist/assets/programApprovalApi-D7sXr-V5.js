import{d as R,r as S,j as e,o as M,z as U,m as O,X as Y,C as V,M as J,s as v}from"./index-DXc16WYz.js";import{k as G}from"./groupAssignmentApi-bj-1TiGd.js";import{P as B}from"./plus-Ck8cIO_E.js";import{t as K,C as H,b as Z}from"./date-1PgwZpeN.js";import{getGroupTrainingCalendarEvents as W}from"./groupTrainingCalendarApi-BWCjwwtT.js";import{R as X}from"./refresh-cw-4bXYEX7k.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=R("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=R("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),oe=({selectedGroupRoom:n,weeklyFrequency:a,monthlyTotal:s,selectedUserIds:l,onSlotsChange:i})=>{const[p,x]=S.useState({}),r=a*4,_=S.useRef("");S.useEffect(()=>{const o=`${JSON.stringify(l)}-${a}-${n}`;if(_.current===o){console.log("[GroupAssignmentInterface] Configuration unchanged, skipping initialization");return}console.log("[GroupAssignmentInterface] Initializing sessions...",{selectedUserIds:l,weeklyFrequency:a,selectedGroupRoom:n,monthlySessions:r});const u={};l.forEach(g=>{u[g]=Array.from({length:r},(c,w)=>({id:`session-${g}-${w}`,date:`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(new Date().getDate()).padStart(2,"0")}`,startTime:"18:00",endTime:"19:00",trainer:"Mike",room:"Αίθουσα Mike",groupType:parseInt(n),notes:""}))}),x(u),_.current=o,i&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent after initialization..."),i(u)},100)},[l,a,n,r,i]);const b=async(o,u,g,c)=>{var T;console.log("[GroupAssignmentInterface] Updating session:",{userId:o,sessionId:u,field:g,value:c});const w=(T=p[o])==null?void 0:T.find(t=>t.id===u);if(!w){console.error("[GroupAssignmentInterface] Current session not found:",{userId:o,sessionId:u});return}const d={...w,[g]:c};if(g==="date"||g==="startTime"||g==="endTime"||g==="room"||g==="groupType")try{const t=await G(d.date,d.startTime,d.endTime,d.room,d.groupType,o);if(!t.isAvailable){U.error(`❌ Η αίθουσα ${d.room} είναι γεμάτη για ${d.date} ${d.startTime}-${d.endTime}. Χωρητικότητα: ${t.currentOccupancy+1}/${t.maxCapacity}. Παρακαλώ επιλέξτε διαφορετική ώρα, ημερομηνία ή αίθουσα.`);return}}catch(t){console.error("Error checking room capacity:",t),console.warn("[GroupAssignmentInterface] Capacity check failed, but allowing change to proceed")}x(t=>{const j={...t,[o]:t[o].map(I=>I.id===u?d:I)};return console.log("[GroupAssignmentInterface] Session updated successfully:",{userId:o,sessionId:u,field:g,value:c}),i&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent of session update..."),i(j)},50),j})},k=async o=>{if((p[o]||[]).length>=r){U.error(`Ο χρήστης μπορεί να έχει μέγιστο ${r} σεσίες τον μήνα (${a} φορές/εβδομάδα × 4 εβδομάδες)`);return}const g={id:`session-${o}-${Date.now()}`,date:`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(new Date().getDate()).padStart(2,"0")}`,startTime:"18:00",endTime:"19:00",trainer:"Mike",room:"Αίθουσα Mike",groupType:parseInt(n),notes:""};try{const c=await G(g.date,g.startTime,g.endTime,g.room,g.groupType);if(!c.isAvailable){U.error(`❌ Η αίθουσα ${g.room} είναι γεμάτη για ${g.date} ${g.startTime}-${g.endTime}. Χωρητικότητα: ${c.currentOccupancy}/${c.maxCapacity}. Παρακαλώ επιλέξτε διαφορετική ώρα ή ημερομηνία.`);return}}catch(c){console.error("Error checking room capacity for new session:",c)}x(c=>{const w={...c,[o]:[...c[o]||[],g]};return i&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent of session addition..."),i(w)},50),w})},$=(o,u)=>{x(g=>{const c={...g,[o]:g[o].filter(w=>w.id!==u)};return i&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent of session removal..."),i(c)},50),c})},C=o=>{var u;return((u=p[o])==null?void 0:u.length)||0},N=o=>C(o)===r,P=["Mike","Jordan"],A=["Αίθουσα Mike","Αίθουσα Jordan"];return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-blue-800 flex items-center",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),"Διαχείριση Ομαδικών Αναθέσεων"]}),e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Προσθέστε σεσίες για κάθε χρήστη (",r," σεσίες/μήνα = ",a," φορές/εβδομάδα × 4 εβδομάδες)",e.jsx("br",{}),e.jsx("span",{className:"text-purple-600 font-medium",children:"💡 Μπορείτε να επιλέξετε διαφορετικό Group Size για κάθε σεσία (2, 3, ή 6 άτομα)"})]})]})}),e.jsx("div",{className:"space-y-6",children:l.map(o=>{const u=p[o]||[],g=N(o);return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-blue-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${g?"bg-green-100":"bg-orange-100"}`,children:e.jsx(M,{className:`h-4 w-4 ${g?"text-green-600":"text-orange-600"}`})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-gray-800",children:["Χρήστης ",o.slice(-8)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u.length,"/",r," σεσίες προγραμματισμένες"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-6 gap-0 text-sm font-semibold text-gray-700",children:[e.jsx("div",{className:"p-3 border-r border-gray-200",children:"📅 Ημερομηνία"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"🕐 Έναρξη"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"👤 Προπονητής"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"🏠 Αίθουσα"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"👥 Group Size"}),e.jsx("div",{className:"p-3",children:"🗑️"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:u.map((c,w)=>e.jsxs("div",{className:"grid grid-cols-6 gap-0 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("input",{type:"date",value:c.date,onChange:d=>b(o,c.id,"date",d.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",lang:"el"})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("input",{type:"time",value:c.startTime,onChange:d=>b(o,c.id,"startTime",d.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500"})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("select",{value:c.trainer,onChange:d=>b(o,c.id,"trainer",d.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",children:P.map(d=>e.jsx("option",{value:d,children:d},d))})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("select",{value:c.room,onChange:d=>b(o,c.id,"room",d.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",children:A.map(d=>e.jsx("option",{value:d,children:d},d))})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsxs("select",{value:c.groupType,onChange:d=>b(o,c.id,"groupType",parseInt(d.target.value)),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:2,children:"2 άτομα"}),e.jsx("option",{value:3,children:"3 άτομα"}),e.jsx("option",{value:6,children:"6 άτομα"})]})}),e.jsx("div",{className:"p-2 flex items-center justify-center",children:e.jsx("button",{onClick:()=>$(o,c.id),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Διαγραφή σεσίας",children:e.jsx(q,{className:"h-4 w-4"})})})]},c.id))}),u.length<r&&e.jsx("div",{className:"border-t border-gray-200 bg-blue-50",children:e.jsx("div",{className:"p-3 text-center",children:e.jsxs("button",{onClick:()=>k(o),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mx-auto text-sm",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Προσθήκη Σεσίας"})]})})})]})]},o)})}),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-green-800",children:"Περίληψη Προγραμματισμού"}),e.jsxs("p",{className:"text-sm text-green-600",children:[l.filter(o=>N(o)).length,"/",l.length," χρήστες έχουν ",r," σεσίες/μήνα"]})]}),e.jsx("div",{className:"text-2xl",children:l.every(o=>N(o))?"✅":"⏳"})]}),!l.every(o=>N(o))&&e.jsxs("div",{className:"mt-2 text-sm text-orange-600",children:["⚠️ Προσθέστε ",r," σεσίες για κάθε χρήστη (",a," φορές/εβδομάδα × 4 εβδομάδες)"]})]})]})},le=({featureEnabled:n=!0})=>{const[a,s]=S.useState(()=>new Date),[l,i]=S.useState([]),[p,x]=S.useState(!1),[r,_]=S.useState(null),[b,k]=S.useState(!1),[$,C]=S.useState(!1),N=a.getMonth()+1,P=a.getFullYear(),A=S.useCallback(async()=>{if(n){x(!0);try{const m=`${P}-${N.toString().padStart(2,"0")}-01`,h=K(new Date(P,N,0));console.log("[GroupTrainingCalendar] Loading events for:",{startDate:m,endDate:h});const f=await W(m,h);i(f.events),console.log("[GroupTrainingCalendar] Loaded events:",f.events.length)}catch(m){console.error("[GroupTrainingCalendar] Error loading events:",m),U.error("Αποτυχία φόρτωσης ημερολογίου")}finally{x(!1)}}},[P,N,n]);S.useEffect(()=>{A()},[A]);const o=()=>{s(m=>new Date(m.getFullYear(),m.getMonth()-1,1))},u=()=>{s(m=>new Date(m.getFullYear(),m.getMonth()+1,1))},g=()=>{s(new Date)},c=m=>{const h=K(m);return l.filter(f=>f.start.startsWith(h))},w=(m,h)=>{const f=m/h*100;return f===0?"text-gray-600":f<=50?"text-green-700":f<100?"text-yellow-700":"text-red-700"},d=(m,h)=>{const f=m/h*100;return f===0?"bg-gray-100":f<=50?"bg-green-200":f<100?"bg-yellow-200":"bg-red-200"},T=(m,h)=>m>=h,t=async m=>{try{x(!0),console.log("[GroupTrainingCalendar] Event clicked:",m);const h=m.id.replace("group-","");console.log("[GroupTrainingCalendar] Event key:",h),_(m),k(!0)}catch(h){console.error("[GroupTrainingCalendar] Error loading event details:",h),U.error("Failed to load event details")}finally{x(!1)}},j=async()=>{C(!0);try{await A(),U.success("Ημερολόγιο ανανεώθηκε")}catch(m){console.error("[GroupTrainingCalendar] Error refreshing:",m),U.error("Αποτυχία ανανέωσης ημερολογίου")}finally{C(!1)}},I=()=>{const m=new Date(P,N,0).getDate(),h=new Date(P,N-1,1).getDay(),f=[];for(let E=0;E<h;E++)f.push(e.jsx("div",{className:"min-h-32 bg-gray-50 rounded-lg"},`empty-${E}`));for(let E=1;E<=m;E++){const z=new Date(P,N-1,E),D=c(z);f.push(e.jsxs("div",{className:"min-h-32 bg-white border border-gray-200 rounded-lg p-2 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:E}),D.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:D.length})]}),e.jsx("div",{className:"space-y-1 flex-grow",children:D.map((y,L)=>{const F=T(y.participants_count,y.capacity);return e.jsx("div",{onClick:()=>t(y),className:`rounded-lg cursor-pointer hover:opacity-90 transition-all duration-200 ${d(y.participants_count,y.capacity)} border border-opacity-20 shadow-sm hover:shadow-md p-2`,title:"Click to view session details",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-sm text-gray-800 mb-1",children:y.start.split("T")[1].substring(0,5)}),e.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[e.jsx("span",{className:"text-lg",children:y.capacity===1?"👤":y.capacity===2?"👥👥":y.capacity===3?"👥👥👥":y.capacity===6?"👥👥👥👥👥👥":"👥"}),e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:[y.participants_count,"/",y.capacity]})]}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:y.capacity===1?"1 άτομο (Individual)":y.capacity===2?"2 άτομα":y.capacity===3?"3 άτομα":y.capacity===6?"6 άτομα":`${y.capacity} άτομα`}),F&&e.jsx("div",{className:"text-xs text-red-600 font-bold mt-1",children:"🔒 ΓΕΜΑΤΟ"})]})},L)})})]},E))}return f};return n?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx("span",{className:"text-blue-600",children:"📅"}),e.jsx("span",{children:"Κλεισμένες Σεσίες - Πρόγραμμα Personal"})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Μηνιαία προβολή -"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Ελεύθερα"})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Μισά"})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Γεμάτα"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:p,children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:g,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:p,children:"Σήμερα"}),e.jsxs("button",{onClick:j,className:"px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-1",disabled:p||$,children:[$?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Ανανέωση"})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:p,children:e.jsx(Z,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:new Date(P,N-1).toLocaleDateString("en-US",{month:"long",year:"numeric"})})})]}),e.jsx("div",{className:"p-4 sm:p-6",children:p?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading calendar events..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"].map(m=>e.jsx("div",{className:"text-center text-sm font-bold text-gray-700 py-3 bg-gray-100 rounded-lg",children:m},m))}),e.jsx("div",{className:"grid grid-cols-7 gap-2 auto-rows-min",children:I()})]})}),b&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Λεπτομέρειες Σεσίας"}),e.jsx("button",{onClick:()=>k(!1),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Y,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(V,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"font-medium",children:[new Date(r.start).toLocaleDateString("el-GR")," στις ",r.start.split("T")[1].substring(0,5)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:r.room})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{children:["Προπονητής: ",r.trainer]})]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${T(r.participants_count,r.capacity)?"bg-red-50 border border-red-200":"bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-medium text-lg",children:"Χωρητικότητα Μαθήματος"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:r.capacity===1?"👤":r.capacity===2?"👥👥":r.capacity===3?"👥👥👥":r.capacity===6?"👥👥👥👥👥👥":"👥"}),e.jsxs("span",{className:`px-3 py-2 rounded-full text-lg font-bold ${d(r.participants_count,r.capacity)} ${w(r.participants_count,r.capacity)}`,children:[r.participants_count,"/",r.capacity]}),T(r.participants_count,r.capacity)&&e.jsx("span",{className:"text-sm text-red-600 font-bold bg-red-100 px-3 py-2 rounded-lg",children:"🔒 ΓΕΜΑΤΟ"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800 mb-2",children:r.capacity===1?"Individual Training - 1 άτομο":r.capacity===2?"Μάθημα για 2 άτομα":r.capacity===3?"Μάθημα για 3 άτομα":r.capacity===6?"Μάθημα για 6 άτομα":`Μάθημα για ${r.capacity} άτομα`}),e.jsx("div",{className:"text-sm text-gray-600",children:r.participants_count===0?"Κανένας συμμετέχων":r.participants_count===1?"1 συμμετέχων":`${r.participants_count} συμμετέχοντες`})]}),T(r.participants_count,r.capacity)&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-100 p-3 rounded-lg",children:"⚠️ Αυτό το μάθημα είναι γεμάτο. Δεν επιτρέπονται νέες κρατήσεις."})]}),r.participants.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Συμμετέχοντες"}),e.jsx("div",{className:"space-y-2",children:r.participants.map((m,h)=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:m.name.split(" ").map(f=>f[0]).join("").toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:m.name}),e.jsx("div",{className:"text-xs text-gray-600",children:m.email})]})]},h))})]})]})]})})})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"Το Ημερολόγιο Ομαδικής Προπόνησης είναι απενεργοποιημένο"})]})})},ie=async n=>{try{if(console.log("[UserInfoAPI] Searching users with term:",n),!n.trim())return[];const{data:a,error:s}=await v.from("user_profiles").select("*").or(`first_name.ilike.%${n}%,last_name.ilike.%${n}%,email.ilike.%${n}%`).order("created_at",{ascending:!1}).limit(50);if(s)throw console.error("[UserInfoAPI] Error searching users:",s),s;if(a&&a.length>0)return console.log("[UserInfoAPI] Found users in text fields:",a.length),a;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n)){console.log("[UserInfoAPI] Search term looks like UUID, searching by exact match");const{data:i,error:p}=await v.from("user_profiles").select("*").eq("user_id",n).order("created_at",{ascending:!1}).limit(50);return p?(console.error("[UserInfoAPI] Error searching by UUID:",p),[]):(console.log("[UserInfoAPI] Found users by UUID:",(i==null?void 0:i.length)||0),i||[])}return console.log("[UserInfoAPI] No users found for search term:",n),[]}catch(a){throw console.error("[UserInfoAPI] Unexpected error searching users:",a),a}},ce=async(n=1,a=10)=>{try{console.log("[UserInfoAPI] Getting random users - page:",n,"limit:",a);const s=(n-1)*a,{data:l,error:i}=await v.from("user_profiles").select("*").order("created_at",{ascending:!1}).range(s,s+a-1);if(i)throw console.error("[UserInfoAPI] Error getting random users:",i),i;return console.log("[UserInfoAPI] Retrieved users:",(l==null?void 0:l.length)||0),l||[]}catch(s){throw console.error("[UserInfoAPI] Unexpected error getting random users:",s),s}},de=async()=>{try{console.log("[UserInfoAPI] Getting user count...");const{count:n,error:a}=await v.from("user_profiles").select("*",{count:"exact",head:!0});if(a)throw console.error("[UserInfoAPI] Error getting user count:",a),a;return console.log("[UserInfoAPI] Total users:",n||0),n||0}catch(n){throw console.error("[UserInfoAPI] Unexpected error getting user count:",n),n}},me=async n=>{try{console.log("[UserInfoAPI] Getting detailed info for user:",n);const{data:a,error:s}=await v.from("user_profiles").select("*").eq("user_id",n).single();if(s)throw console.error("[UserInfoAPI] Error getting user info:",s),s;if(!a)throw new Error("User not found");const{data:l,error:i}=await v.from("memberships").select(`
        id,
        package_id,
        status,
        is_active,
        start_date,
        end_date,
        created_at,
        membership_packages!memberships_package_id_fkey(
          name,
          is_active
        )
      `).eq("user_id",n).order("created_at",{ascending:!1});if(i)throw console.error("[UserInfoAPI] Error getting memberships:",i),i;const p=(l||[]).map(t=>{var j;return{id:t.id,package_id:t.package_id,package_name:((j=t.membership_packages)==null?void 0:j.name)||"Unknown Package",status:t.status,credits_remaining:0,credits_total:0,start_date:t.start_date,end_date:t.end_date,is_active:t.is_active&&new Date(t.end_date)>=new Date,created_at:t.created_at}}),x=p.filter(t=>t.is_active),{data:r,error:_}=await v.from("user_cash_transactions").select("*").eq("user_id",n).order("created_at",{ascending:!1});if(_)throw console.error("[UserInfoAPI] Error getting cash transactions:",_),_;const{data:b,error:k}=await v.from("payments").select("*").eq("user_id",n).order("created_at",{ascending:!1});k&&console.error("[UserInfoAPI] Error getting payments:",k);const $=(r||[]).map(t=>({id:t.id,amount:t.amount,currency:"EUR",status:"approved",payment_method:t.transaction_type==="cash"?"Μετρητά":"POS",transaction_id:t.id,created_at:t.created_at,membership_id:t.program_id,notes:t.notes})),C=(b||[]).map(t=>({id:t.id,amount:t.amount,currency:t.currency,status:t.status,payment_method:t.payment_method,transaction_id:t.transaction_id,created_at:t.created_at,membership_id:t.membership_id})),N=[...$,...C].sort((t,j)=>new Date(j.created_at).getTime()-new Date(t.created_at).getTime()),P=N.filter(t=>t.status==="approved").reduce((t,j)=>t+j.amount,0),{data:A,error:o}=await v.from("user_kettlebell_points").select("*").eq("user_id",n).order("created_at",{ascending:!1});o&&console.error("[UserInfoAPI] Error getting kettlebell points:",o);const u=(A||[]).reduce((t,j)=>t+(j.points||0),0),g=(A||[]).map(t=>({id:t.id,points:t.points||0,program_id:t.program_id,created_at:t.created_at})),{data:c,error:w}=await v.from("membership_requests").select(`
        id,
        package_id,
        duration_type,
        requested_price,
        status,
        classes_count,
        created_at,
        updated_at,
        has_installments,
        installment_1_amount,
        installment_2_amount,
        installment_3_amount,
        installment_1_payment_method,
        installment_2_payment_method,
        installment_3_payment_method,
        installment_1_due_date,
        installment_2_due_date,
        installment_3_due_date,
        membership_packages!membership_requests_package_id_fkey(
          name
        )
      `).eq("user_id",n).eq("status","pending").order("created_at",{ascending:!1});w&&console.error("[UserInfoAPI] Error getting membership requests:",w);const d=(c||[]).map(t=>{var j;return{id:t.id,package_id:t.package_id,package_name:((j=t.membership_packages)==null?void 0:j.name)||"Unknown Package",duration_type:t.duration_type,requested_price:t.requested_price,status:t.status,classes_count:t.classes_count,created_at:t.created_at,updated_at:t.updated_at,has_installments:t.has_installments,installment_1_amount:t.installment_1_amount,installment_2_amount:t.installment_2_amount,installment_3_amount:t.installment_3_amount,installment_1_payment_method:t.installment_1_payment_method,installment_2_payment_method:t.installment_2_payment_method,installment_3_payment_method:t.installment_3_payment_method,installment_1_due_date:t.installment_1_due_date,installment_2_due_date:t.installment_2_due_date,installment_3_due_date:t.installment_3_due_date}}),T={user_info:a,active_memberships:x,all_memberships:p,payment_history:N,kettlebell_points:{total_points:u,points_history:g},total_paid:P,pending_requests:d};return console.log("[UserInfoAPI] Retrieved detailed info for user:",n),T}catch(a){throw console.error("[UserInfoAPI] Unexpected error getting detailed user info:",a),a}},ge=async(n,a)=>{try{const{error:s}=await v.from("user_old_members_usage").insert({user_id:n,created_by:a});return s?(console.error("Error marking old members as used:",s),!1):!0}catch(s){return console.error("Exception marking old members as used:",s),!1}},pe=async(n,a,s,l)=>{try{if(a<=0)return!0;const{error:i}=await v.from("user_kettlebell_points").insert({user_id:n,points:a,program_id:s,created_by:l});return i?(console.error("Error saving kettlebell points:",i),!1):!0}catch(i){return console.error("Exception saving kettlebell points:",i),!1}},ue=async(n,a)=>{try{console.log("[getTotalKettlebellPoints] Starting to fetch total points...");let s=v.from("user_kettlebell_points").select("points, created_at");if(n&&(s=s.gte("created_at",n)),a){const x=a.length===10?`${a}T23:59:59.999Z`:a;s=s.lte("created_at",x)}const{data:l,error:i}=await s;if(i)return console.error("[getTotalKettlebellPoints] Error getting total kettlebell points:",i),0;const p=(l==null?void 0:l.reduce((x,r)=>x+r.points,0))||0;return console.log("[getTotalKettlebellPoints] Total points calculated:",p,"from",(l==null?void 0:l.length)||0,"records"),p}catch(s){return console.error("[getTotalKettlebellPoints] Exception getting total kettlebell points:",s),0}},xe=async(n,a)=>{try{console.log("[getKettlebellPointsSummary] Starting to fetch kettlebell points...");let s=v.from("user_kettlebell_points").select(`
        user_id,
        points,
        created_at,
        user_profiles!user_kettlebell_points_user_id_fkey(
          first_name,
          last_name,
          email
        )
      `).order("created_at",{ascending:!1});if(n&&(s=s.gte("created_at",n)),a){const r=a.length===10?`${a}T23:59:59.999Z`:a;s=s.lte("created_at",r)}const{data:l,error:i}=await s;if(i)return console.error("[getKettlebellPointsSummary] Error getting kettlebell points summary:",i),[];if(console.log("[getKettlebellPointsSummary] Raw data received:",(l==null?void 0:l.length)||0,"records"),console.log("[getKettlebellPointsSummary] Sample data:",l==null?void 0:l.slice(0,2)),!l||l.length===0)return console.log("[getKettlebellPointsSummary] No data found, returning empty array"),[];const p=new Map;l.forEach(r=>{const _=r.user_id,b=r.user_profiles;p.has(_)||p.set(_,{user_id:_,user_name:b?`${b.first_name||""} ${b.last_name||""}`.trim():`User ${_.slice(0,8)}`,user_email:(b==null?void 0:b.email)||"No email",total_points:0,points_count:0,last_updated:r.created_at});const k=p.get(_);k.total_points+=r.points,k.points_count+=1,new Date(r.created_at)>new Date(k.last_updated)&&(k.last_updated=r.created_at)});const x=Array.from(p.values()).sort((r,_)=>_.total_points-r.total_points);return console.log("[getKettlebellPointsSummary] Processed summary:",x),x}catch(s){return console.error("[getKettlebellPointsSummary] Exception getting kettlebell points summary:",s),[]}},he=async n=>{try{const{data:a,error:s}=await v.from("user_kettlebell_points").select("*").eq("user_id",n).order("created_at",{ascending:!1});return s?(console.error("Error getting user kettlebell points:",s),[]):a||[]}catch(a){return console.error("Exception getting user kettlebell points:",a),[]}},fe=async(n,a,s)=>{try{console.log("[saveProgramApprovalState] Saving approval state:",{userId:n,approvalStatus:a,options:s});const{data:l,error:i}=await v.from("program_approval_states").insert({user_id:n,program_id:s.programId,approval_status:a,old_members_used:s.oldMembersUsed||!1,kettlebell_points:s.kettlebellPoints??0,cash_amount:s.cashAmount??0,pos_amount:s.posAmount??0,created_by:s.createdBy,notes:s.notes,group_room_size:s.groupRoomSize,weekly_frequency:s.weeklyFrequency,monthly_total:s.monthlyTotal}).select().single();return i?(console.error("[saveProgramApprovalState] Error saving approval state:",i),!1):(console.log("[saveProgramApprovalState] Approval state saved successfully:",l),!0)}catch(l){return console.error("[saveProgramApprovalState] Exception saving approval state:",l),!1}};export{le as G,ne as P,q as T,de as a,me as b,ue as c,xe as d,oe as e,he as f,ce as g,pe as h,fe as i,ge as m,ie as s};
