-- ROLLBACK: ΔΙΑΓΡΑΦΗ ΧΡΗΣΤΩΝ ΠΟΥ ΠΡΟΣΤΕΘΗΚΑΝ
-- Ασφαλής επαναφορά σε περίπτωση προβλήματος
-- Εκτέλεση στο Supabase SQL Editor

-- ========================================
-- ΠΡΟΕΙΔΟΠΟΙΗΣΗ
-- ========================================

SELECT 'ΠΡΟΣΟΧΗ: Αυτό το script θα διαγράψει όλους τους χρήστες που προστέθηκαν!' as warning;

-- ========================================
-- ΕΛΕΓΧΟΣ ΠΡΙΝ ΤΗ ΔΙΑΓΡΑΦΗ
-- ========================================

-- Εμφάνιση χρηστών που θα διαγραφούν
SELECT 
    'Χρήστες που θα διαγραφούν:' as info,
    up.user_id,
    up.first_name,
    up.last_name,
    up.email,
    up.created_at
FROM user_profiles up
WHERE up.created_at > NOW() - INTERVAL '1 hour' -- χρήστες που προστέθηκαν την τελευταία ώρα
ORDER BY up.created_at DESC;

-- ========================================
-- ΔΙΑΓΡΑΦΗ ΧΡΗΣΤΩΝ
-- ========================================

-- Διαγραφή χρηστών που προστέθηκαν πρόσφατα
-- (Προσοχή: Αυτό θα διαγράψει όλους τους χρήστες που δημιουργήθηκαν την τελευταία ώρα)
DELETE FROM user_profiles 
WHERE created_at > NOW() - INTERVAL '1 hour';

-- ========================================
-- ΕΠΑΛΗΘΕΥΣΗ ΔΙΑΓΡΑΦΗΣ
-- ========================================

-- Έλεγχος ότι οι χρήστες διαγράφηκαν
SELECT 
    'Επαλήθευση διαγραφής:' as info,
    COUNT(*) as remaining_users
FROM user_profiles 
WHERE created_at > NOW() - INTERVAL '1 hour';

-- Εμφάνιση τρέχουσας κατάστασης
SELECT 
    'Τρέχουσα κατάσταση user_profiles:' as info,
    COUNT(*) as total_users
FROM user_profiles;

-- Success message
SELECT 'Η επαναφορά ολοκληρώθηκε!' as result;
