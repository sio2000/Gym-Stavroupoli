import{d as V,r as b,j as e,n as F,z as D,A as Z,X as H,C as W,M as X,s as N}from"./index-CPD3QOvx.js";import{k as Q,l as Y,m as q}from"./groupAssignmentApi-UnScOW0R.js";import{P as ee}from"./plus-C1rRojJA.js";import{t as J}from"./date-D_3Ba85T.js";import{getGroupTrainingCalendarEvents as te}from"./groupTrainingCalendarApi-BKcvbHCT.js";import{C as se,a as re}from"./chevron-right-C5Of-bgN.js";import{R as ae}from"./refresh-cw-DsWJhv7_.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=V("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=V("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ue=({selectedGroupRoom:o,weeklyFrequency:a,monthlyTotal:n,selectedUserIds:l,onSlotsChange:g})=>{const[h,_]=b.useState({}),[r,v]=b.useState("new"),[w,T]=b.useState(!1),[S,G]=b.useState({}),A=b.useRef(""),M=b.useRef(""),k=async i=>{if(r!=="existing")return;const x=h[i]||[];await q(i,a,x.map(c=>({date:c.date,start_time:c.startTime,end_time:c.endTime,trainer:c.trainer,room:c.room,group_type:c.groupType,notes:c.notes||""})))},y=a*4,U=b.useRef("");b.useEffect(()=>{const i=`${JSON.stringify(l)}-${a}-${o}`;if(U.current===i){console.log("[GroupAssignmentInterface] Configuration unchanged, skipping initialization");return}console.log("[GroupAssignmentInterface] Initializing sessions...",{selectedUserIds:l,weeklyFrequency:a,selectedGroupRoom:o,monthlySessions:y});const x={};l.forEach(c=>{x[c]=Array.from({length:y},(s,p)=>({id:`session-${c}-${p}`,date:`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(new Date().getDate()).padStart(2,"0")}`,startTime:"18:00",endTime:"19:00",trainer:"Mike",room:"Αίθουσα Mike",groupType:parseInt(o),notes:""}))}),r==="new"&&(_(x),g&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent after initialization..."),g(x)},100)),U.current=i},[l,a,o,y,g,r]),b.useEffect(()=>{(async()=>{if(r!=="existing")return;const x=`${JSON.stringify(l)}-${o}`;if(!(w||A.current===x)){A.current=x,T(!0);try{const c={};for(const s of l)try{const d=(await Q(s,a)||[]).map((m,f)=>({id:`existing-${s}-${f}-${Date.now()}`,date:m.date,startTime:m.start_time,endTime:m.end_time,trainer:m.trainer,room:m.room,groupType:m.group_type,notes:m.notes||""}));c[s]=d}catch(p){console.error("[GroupAssignmentInterface] Exception loading existing for",s,p),c[s]=[]}if(G(c),_(c),Object.values(c).some(s=>s.length>0)){const s=Object.values(c).reduce((d,m)=>d+m.length,0),p=`${x}-${s}`;M.current!==p&&(M.current=p,D.success(`Φορτώθηκαν ${s} υπάρχουσες σεσίες`))}g&&setTimeout(()=>g(c),50)}finally{T(!1)}}})()},[r,l,o,g,w]);const E=async(i,x,c,s)=>{var m;console.log("[GroupAssignmentInterface] Updating session:",{userId:i,sessionId:x,field:c,value:s});const p=(m=h[i])==null?void 0:m.find(f=>f.id===x);if(!p){console.error("[GroupAssignmentInterface] Current session not found:",{userId:i,sessionId:x});return}const d={...p,[c]:s};if(c==="date"||c==="startTime"||c==="endTime"||c==="room"||c==="groupType")try{const f=await Y(d.date,d.startTime,d.endTime,d.room,d.groupType,i);if(!f.isAvailable){D.error(`❌ Η αίθουσα ${d.room} είναι γεμάτη για ${d.date} ${d.startTime}-${d.endTime}. Χωρητικότητα: ${f.currentOccupancy+1}/${f.maxCapacity}. Παρακαλώ επιλέξτε διαφορετική ώρα, ημερομηνία ή αίθουσα.`);return}}catch(f){console.error("Error checking room capacity:",f),console.warn("[GroupAssignmentInterface] Capacity check failed, but allowing change to proceed")}_(f=>{const $={...f,[i]:f[i].map(u=>u.id===x?d:u)};return console.log("[GroupAssignmentInterface] Session updated successfully:",{userId:i,sessionId:x,field:c,value:s}),g&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent of session update..."),g($)},50),$}),r==="existing"&&await k(i)},R=async i=>{if((h[i]||[]).length>=y){D.error(`Ο χρήστης μπορεί να έχει μέγιστο ${y} σεσίες τον μήνα (${a} φορές/εβδομάδα × 4 εβδομάδες)`);return}const c={id:`session-${i}-${Date.now()}`,date:`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(new Date().getDate()).padStart(2,"0")}`,startTime:"18:00",endTime:"19:00",trainer:"Mike",room:"Αίθουσα Mike",groupType:parseInt(o),notes:""};try{const s=await Y(c.date,c.startTime,c.endTime,c.room,c.groupType);if(!s.isAvailable){D.error(`❌ Η αίθουσα ${c.room} είναι γεμάτη για ${c.date} ${c.startTime}-${c.endTime}. Χωρητικότητα: ${s.currentOccupancy}/${s.maxCapacity}. Παρακαλώ επιλέξτε διαφορετική ώρα ή ημερομηνία.`);return}}catch(s){console.error("Error checking room capacity for new session:",s)}_(s=>{const p={...s,[i]:[...s[i]||[],c]};return g&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent of session addition..."),g(p)},50),p}),r==="existing"&&await k(i)},K=async(i,x)=>{_(c=>{const s={...c,[i]:c[i].filter(p=>p.id!==x)};return g&&setTimeout(()=>{console.log("[GroupAssignmentInterface] Notifying parent of session removal..."),g(s)},50),s}),r==="existing"&&await k(i)},z=i=>{var x;return((x=h[i])==null?void 0:x.length)||0},C=i=>z(i)===y,t=["Mike","Jordan"],j=["Αίθουσα Mike","Αίθουσα Jordan"];return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold text-blue-800 flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Διαχείριση Ομαδικών Αναθέσεων"]}),e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Προσθέστε σεσίες για κάθε χρήστη (",y," σεσίες/μήνα = ",a," φορές/εβδομάδα × 4 εβδομάδες)",e.jsx("br",{}),e.jsx("span",{className:"text-purple-600 font-medium",children:"💡 Μπορείτε να επιλέξετε διαφορετικό Group Size για κάθε σεσία (2, 3, 6, ή 10 άτομα)"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Φίλτρο Σεσιών:"}),e.jsx("button",{onClick:()=>v("new"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${r==="new"?"bg-blue-500 text-white shadow":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"🆕 Νέες Σεσίες"}),e.jsxs("button",{onClick:()=>v("existing"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${r==="existing"?"bg-green-500 text-white shadow":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:["📚 Υπάρχουσες Σεσίες",w&&e.jsx("span",{className:"ml-2",children:"⏳"})]})]})]}),e.jsx("div",{className:"space-y-6",children:l.map(i=>{var s,p;const x=h[i]||[],c=C(i);return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-blue-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${c?"bg-green-100":"bg-orange-100"}`,children:e.jsx(F,{className:`h-4 w-4 ${c?"text-green-600":"text-orange-600"}`})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-gray-800",children:["Χρήστης ",i.slice(-8)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[x.length,"/",y," σεσίες προγραμματισμένες"]}),r==="existing"&&e.jsx("div",{className:`${(((s=S[i])==null?void 0:s.length)||0)>0?"text-green-700 bg-green-100":"text-gray-600 bg-gray-100"} text-xs inline-block px-2 py-0.5 rounded mt-1`,children:(((p=S[i])==null?void 0:p.length)||0)>0?`✅ ${(S[i]||[]).length} υπάρχουσες σεσίες φορτώθηκαν`:!w&&"ℹ️ Δεν βρέθηκαν υπάρχουσες σεσίες"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-6 gap-0 text-sm font-semibold text-gray-700",children:[e.jsx("div",{className:"p-3 border-r border-gray-200",children:"📅 Ημερομηνία"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"🕐 Έναρξη"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"👤 Προπονητής"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"🏠 Αίθουσα"}),e.jsx("div",{className:"p-3 border-r border-gray-200",children:"👥 Group Size"}),e.jsx("div",{className:"p-3",children:"🗑️"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:x.map(d=>e.jsxs("div",{className:"grid grid-cols-6 gap-0 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("input",{type:"date",value:d.date,onChange:m=>E(i,d.id,"date",m.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",lang:"el"})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("input",{type:"time",value:d.startTime,onChange:m=>E(i,d.id,"startTime",m.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500"})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("select",{value:d.trainer,onChange:m=>E(i,d.id,"trainer",m.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",children:t.map(m=>e.jsx("option",{value:m,children:m},m))})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsx("select",{value:d.room,onChange:m=>E(i,d.id,"room",m.target.value),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",children:j.map(m=>e.jsx("option",{value:m,children:m},m))})}),e.jsx("div",{className:"p-2 border-r border-gray-200",children:e.jsxs("select",{value:d.groupType,onChange:m=>E(i,d.id,"groupType",parseInt(m.target.value)),className:"w-full border border-gray-300 rounded px-2 py-1 text-sm focus:ring-1 focus:ring-blue-500",children:[e.jsx("option",{value:2,children:"2 άτομα"}),e.jsx("option",{value:3,children:"3 άτομα"}),e.jsx("option",{value:6,children:"6 άτομα"}),e.jsx("option",{value:10,children:"10 άτομα"})]})}),e.jsx("div",{className:"p-2 flex items-center justify-center",children:e.jsx("button",{onClick:()=>K(i,d.id),className:"p-1 text-red-600 hover:bg-red-100 rounded transition-colors",title:"Διαγραφή σεσίας",children:e.jsx(ne,{className:"h-4 w-4"})})})]},d.id))}),x.length<y&&e.jsx("div",{className:"border-t border-gray-200 bg-blue-50",children:e.jsx("div",{className:"p-3 text-center",children:e.jsxs("button",{onClick:()=>R(i),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mx-auto text-sm",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Προσθήκη Σεσίας"})]})})})]})]},i)})}),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-green-800",children:"Περίληψη Προγραμματισμού"}),e.jsxs("p",{className:"text-sm text-green-600",children:[l.filter(i=>C(i)).length,"/",l.length," χρήστες έχουν ",y," σεσίες/μήνα"]})]}),e.jsx("div",{className:"text-2xl",children:l.every(i=>C(i))?"✅":"⏳"})]}),!l.every(i=>C(i))&&e.jsxs("div",{className:"mt-2 text-sm text-orange-600",children:["⚠️ Προσθέστε ",y," σεσίες για κάθε χρήστη (",a," φορές/εβδομάδα × 4 εβδομάδες)"]})]})]})},xe=({featureEnabled:o=!0})=>{const[a,n]=b.useState(()=>new Date),[l,g]=b.useState([]),[h,_]=b.useState(!1),[r,v]=b.useState(null),[w,T]=b.useState(!1),[S,G]=b.useState(!1),[A,M]=b.useState(0),k=a.getMonth()+1,y=a.getFullYear(),U=b.useCallback(async()=>{if(o){_(!0);try{const s=`${y}-${k.toString().padStart(2,"0")}-01`,p=J(new Date(y,k,0));console.log("[GroupTrainingCalendar] Loading events for:",{startDate:s,endDate:p});const d=await te(s,p),m=d.events.sort((f,$)=>{const u=new Date(f.start).getTime(),P=new Date($.start).getTime();return u-P});g(m),M(f=>f+1),console.log("[GroupTrainingCalendar] Loaded events:",d.events.length)}catch(s){console.error("[GroupTrainingCalendar] Error loading events:",s),D.error("Αποτυχία φόρτωσης ημερολογίου")}finally{_(!1)}}},[y,k,o]);b.useEffect(()=>{U()},[U]);const E=()=>{n(s=>new Date(s.getFullYear(),s.getMonth()-1,1))},R=()=>{n(s=>new Date(s.getFullYear(),s.getMonth()+1,1))},K=()=>{n(new Date)},z=b.useMemo(()=>s=>{const p=J(s);return l.filter(f=>f.start.startsWith(p)).sort((f,$)=>{const u=f.start.split("T")[1].replace(/:\d{2}$/,""),P=$.start.split("T")[1].replace(/:\d{2}$/,"");if(u!==P)return u.localeCompare(P);const I=new Date(f.start).getTime(),L=new Date($.start).getTime();return isNaN(I)||isNaN(L)?0:I-L})},[l,A]),C=(s,p)=>{const d=s/p*100;return d===0?"text-gray-600":d<=50?"text-green-700":d<100?"text-yellow-700":"text-red-700"},t=(s,p)=>{const d=s/p*100;return d===0?"bg-gray-100":d<=50?"bg-green-200":d<100?"bg-yellow-200":"bg-red-200"},j=(s,p)=>s>=p,i=async s=>{try{_(!0),console.log("[GroupTrainingCalendar] Event clicked:",s);const p=s.id.replace("group-","");console.log("[GroupTrainingCalendar] Event key:",p),v(s),T(!0)}catch(p){console.error("[GroupTrainingCalendar] Error loading event details:",p),D.error("Failed to load event details")}finally{_(!1)}},x=async()=>{G(!0);try{g([]),M(0),await new Promise(s=>setTimeout(s,100)),await U(),D.success("Ημερολόγιο ανανεώθηκε")}catch(s){console.error("[GroupTrainingCalendar] Error refreshing:",s),D.error("Αποτυχία ανανέωσης ημερολογίου")}finally{G(!1)}},c=()=>{const s=new Date(y,k,0).getDate(),p=new Date(y,k-1,1).getDay(),d=[];for(let m=0;m<p;m++)d.push(e.jsx("div",{className:"min-h-32 bg-gray-50 rounded-lg"},`empty-${m}`));for(let m=1;m<=s;m++){const f=new Date(y,k-1,m);let $=z(f);$=[...$].sort((u,P)=>{const I=u.start.split("T")[1].replace(/:\d{2}$/,""),L=P.start.split("T")[1].replace(/:\d{2}$/,"");if(I!==L)return I.localeCompare(L);const O=new Date(u.start).getTime(),B=new Date(P.start).getTime();return isNaN(O)||isNaN(B)?0:O-B}),d.push(e.jsxs("div",{className:"min-h-32 bg-white border border-gray-200 rounded-lg p-2 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:m}),$.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:$.length})]}),e.jsx("div",{className:"space-y-1 flex-grow",children:$.map((u,P)=>{const I=j(u.participants_count,u.capacity);return e.jsx("div",{onClick:()=>i(u),className:`rounded-lg cursor-pointer hover:opacity-90 transition-all duration-200 ${t(u.participants_count,u.capacity)} border border-opacity-20 shadow-sm hover:shadow-md p-2`,title:"Click to view session details",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-sm text-gray-800 mb-1",children:u.start.split("T")[1].substring(0,5)}),e.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-1",children:[e.jsx("span",{className:"text-lg",children:u.capacity===1?"👤":u.capacity===2?"👥👥":u.capacity===3?"👥👥👥":u.capacity===6?"👥👥👥👥👥👥":"👥"}),e.jsxs("span",{className:"text-xs font-bold text-gray-700",children:[u.participants_count,"/",u.capacity]})]}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:u.capacity===1?"1 άτομο (Individual)":u.capacity===2?"2 άτομα":u.capacity===3?"3 άτομα":u.capacity===6?"6 άτομα":`${u.capacity} άτομα`}),I&&e.jsx("div",{className:"text-xs text-red-600 font-bold mt-1",children:"🔒 ΓΕΜΑΤΟ"})]})},`${u.id}-${u.start}-${u.trainer}-${u.room}-${u.capacity}-${P}-${A}`)})})]},m))}return d};return o?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx("span",{className:"text-blue-600",children:"📅"}),e.jsx("span",{children:"Κλεισμένες Σεσίες - Πρόγραμμα Personal"})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Μηνιαία προβολή -"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Ελεύθερα"})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Μισά"})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:"Γεμάτα"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:h,children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:K,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:h,children:"Σήμερα"}),e.jsxs("button",{onClick:x,className:"px-3 py-1 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-1",disabled:h||S,children:[S?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Ανανέωση"})]}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:h,children:e.jsx(re,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:new Date(y,k-1).toLocaleDateString("en-US",{month:"long",year:"numeric"})})})]}),e.jsx("div",{className:"p-4 sm:p-6",children:h?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading calendar events..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"].map(s=>e.jsx("div",{className:"text-center text-sm font-bold text-gray-700 py-3 bg-gray-100 rounded-lg",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-2 auto-rows-min",children:c()})]})}),w&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Λεπτομέρειες Σεσίας"}),e.jsx("button",{onClick:()=>T(!1),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(H,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"font-medium",children:[new Date(r.start).toLocaleDateString("el-GR")," στις ",r.start.split("T")[1].substring(0,5)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(X,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{children:r.room})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{children:["Προπονητής: ",r.trainer]})]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${j(r.participants_count,r.capacity)?"bg-red-50 border border-red-200":"bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-medium text-lg",children:"Χωρητικότητα Μαθήματος"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:r.capacity===1?"👤":r.capacity===2?"👥👥":r.capacity===3?"👥👥👥":r.capacity===6?"👥👥👥👥👥👥":"👥"}),e.jsxs("span",{className:`px-3 py-2 rounded-full text-lg font-bold ${t(r.participants_count,r.capacity)} ${C(r.participants_count,r.capacity)}`,children:[r.participants_count,"/",r.capacity]}),j(r.participants_count,r.capacity)&&e.jsx("span",{className:"text-sm text-red-600 font-bold bg-red-100 px-3 py-2 rounded-lg",children:"🔒 ΓΕΜΑΤΟ"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800 mb-2",children:r.capacity===1?"Individual Training - 1 άτομο":r.capacity===2?"Μάθημα για 2 άτομα":r.capacity===3?"Μάθημα για 3 άτομα":r.capacity===6?"Μάθημα για 6 άτομα":`Μάθημα για ${r.capacity} άτομα`}),e.jsx("div",{className:"text-sm text-gray-600",children:r.participants_count===0?"Κανένας συμμετέχων":r.participants_count===1?"1 συμμετέχων":`${r.participants_count} συμμετέχοντες`})]}),j(r.participants_count,r.capacity)&&e.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-100 p-3 rounded-lg",children:"⚠️ Αυτό το μάθημα είναι γεμάτο. Δεν επιτρέπονται νέες κρατήσεις."})]}),r.participants.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Συμμετέχοντες"}),e.jsx("div",{className:"space-y-2",children:r.participants.map((s,p)=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:s.name.split(" ").map(d=>d[0]).join("").toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsx("div",{className:"text-xs text-gray-600",children:s.email})]})]},p))})]})]})]})})})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-yellow-800",children:"Το Ημερολόγιο Ομαδικής Προπόνησης είναι απενεργοποιημένο"})]})})},he=async o=>{try{if(console.log("[UserInfoAPI] Searching users with term:",o),!o.trim())return[];const{data:a,error:n}=await N.from("user_profiles").select("*").or(`first_name.ilike.%${o}%,last_name.ilike.%${o}%,email.ilike.%${o}%`).order("created_at",{ascending:!1}).limit(50);if(n)throw console.error("[UserInfoAPI] Error searching users:",n),n;if(a&&a.length>0)return console.log("[UserInfoAPI] Found users in text fields:",a.length),a;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o)){console.log("[UserInfoAPI] Search term looks like UUID, searching by exact match");const{data:g,error:h}=await N.from("user_profiles").select("*").eq("user_id",o).order("created_at",{ascending:!1}).limit(50);return h?(console.error("[UserInfoAPI] Error searching by UUID:",h),[]):(console.log("[UserInfoAPI] Found users by UUID:",(g==null?void 0:g.length)||0),g||[])}return console.log("[UserInfoAPI] No users found for search term:",o),[]}catch(a){throw console.error("[UserInfoAPI] Unexpected error searching users:",a),a}},fe=async(o=1,a=10)=>{try{console.log("[UserInfoAPI] Getting random users - page:",o,"limit:",a);const n=(o-1)*a,{data:l,error:g}=await N.from("user_profiles").select("*").order("created_at",{ascending:!1}).range(n,n+a-1);if(g)throw console.error("[UserInfoAPI] Error getting random users:",g),g;return console.log("[UserInfoAPI] Retrieved users:",(l==null?void 0:l.length)||0),l||[]}catch(n){throw console.error("[UserInfoAPI] Unexpected error getting random users:",n),n}},ye=async()=>{try{console.log("[UserInfoAPI] Getting user count...");const{count:o,error:a}=await N.from("user_profiles").select("*",{count:"exact",head:!0});if(a)throw console.error("[UserInfoAPI] Error getting user count:",a),a;return console.log("[UserInfoAPI] Total users:",o||0),o||0}catch(o){throw console.error("[UserInfoAPI] Unexpected error getting user count:",o),o}},_e=async o=>{try{console.log("[UserInfoAPI] Getting detailed info for user:",o);const{data:a,error:n}=await N.from("user_profiles").select("*").eq("user_id",o).single();if(n)throw console.error("[UserInfoAPI] Error getting user info:",n),n;if(!a)throw new Error("User not found");const{data:l,error:g}=await N.from("memberships").select(`
        id,
        package_id,
        status,
        is_active,
        start_date,
        end_date,
        created_at,
        membership_packages!memberships_package_id_fkey(
          name,
          is_active
        )
      `).eq("user_id",o).order("created_at",{ascending:!1});if(g)throw console.error("[UserInfoAPI] Error getting memberships:",g),g;const h=(l||[]).map(t=>{var j;return{id:t.id,package_id:t.package_id,package_name:((j=t.membership_packages)==null?void 0:j.name)||"Unknown Package",status:t.status,credits_remaining:0,credits_total:0,start_date:t.start_date,end_date:t.end_date,is_active:t.is_active&&new Date(t.end_date)>=new Date,created_at:t.created_at}}),_=h.filter(t=>t.is_active),{data:r,error:v}=await N.from("user_cash_transactions").select("*").eq("user_id",o).order("created_at",{ascending:!1});if(v)throw console.error("[UserInfoAPI] Error getting cash transactions:",v),v;const{data:w,error:T}=await N.from("payments").select("*").eq("user_id",o).order("created_at",{ascending:!1});T&&console.error("[UserInfoAPI] Error getting payments:",T);const S=(r||[]).map(t=>({id:t.id,amount:t.amount,currency:"EUR",status:"approved",payment_method:t.transaction_type==="cash"?"Μετρητά":"POS",transaction_id:t.id,created_at:t.created_at,membership_id:t.program_id,notes:t.notes})),G=(w||[]).map(t=>({id:t.id,amount:t.amount,currency:t.currency,status:t.status,payment_method:t.payment_method,transaction_id:t.transaction_id,created_at:t.created_at,membership_id:t.membership_id})),A=[...S,...G].sort((t,j)=>new Date(j.created_at).getTime()-new Date(t.created_at).getTime()),M=A.filter(t=>t.status==="approved").reduce((t,j)=>t+j.amount,0),{data:k,error:y}=await N.from("user_kettlebell_points").select("*").eq("user_id",o).order("created_at",{ascending:!1});y&&console.error("[UserInfoAPI] Error getting kettlebell points:",y);const U=(k||[]).reduce((t,j)=>t+(j.points||0),0),E=(k||[]).map(t=>({id:t.id,points:t.points||0,program_id:t.program_id,created_at:t.created_at})),{data:R,error:K}=await N.from("membership_requests").select(`
        id,
        package_id,
        duration_type,
        requested_price,
        status,
        classes_count,
        created_at,
        updated_at,
        has_installments,
        installment_1_amount,
        installment_2_amount,
        installment_3_amount,
        installment_1_payment_method,
        installment_2_payment_method,
        installment_3_payment_method,
        installment_1_due_date,
        installment_2_due_date,
        installment_3_due_date,
        membership_packages!membership_requests_package_id_fkey(
          name
        )
      `).eq("user_id",o).eq("status","pending").order("created_at",{ascending:!1});K&&console.error("[UserInfoAPI] Error getting membership requests:",K);const z=(R||[]).map(t=>{var j;return{id:t.id,package_id:t.package_id,package_name:((j=t.membership_packages)==null?void 0:j.name)||"Unknown Package",duration_type:t.duration_type,requested_price:t.requested_price,status:t.status,classes_count:t.classes_count,created_at:t.created_at,updated_at:t.updated_at,has_installments:t.has_installments,installment_1_amount:t.installment_1_amount,installment_2_amount:t.installment_2_amount,installment_3_amount:t.installment_3_amount,installment_1_payment_method:t.installment_1_payment_method,installment_2_payment_method:t.installment_2_payment_method,installment_3_payment_method:t.installment_3_payment_method,installment_1_due_date:t.installment_1_due_date,installment_2_due_date:t.installment_2_due_date,installment_3_due_date:t.installment_3_due_date}}),C={user_info:a,active_memberships:_,all_memberships:h,payment_history:A,kettlebell_points:{total_points:U,points_history:E},total_paid:M,pending_requests:z};return console.log("[UserInfoAPI] Retrieved detailed info for user:",o),C}catch(a){throw console.error("[UserInfoAPI] Unexpected error getting detailed user info:",a),a}},be=async(o,a)=>{try{const{error:n}=await N.from("user_old_members_usage").insert({user_id:o,created_by:a});return n?(console.error("Error marking old members as used:",n),!1):!0}catch(n){return console.error("Exception marking old members as used:",n),!1}},je=async(o,a,n,l)=>{try{if(a<=0)return!0;const{error:g}=await N.from("user_kettlebell_points").insert({user_id:o,points:a,program_id:n,created_by:l});return g?(console.error("Error saving kettlebell points:",g),!1):!0}catch(g){return console.error("Exception saving kettlebell points:",g),!1}},ve=async(o,a)=>{try{console.log("[getTotalKettlebellPoints] Starting to fetch total points...");let n=N.from("user_kettlebell_points").select("points, created_at");if(o&&(n=n.gte("created_at",o)),a){const _=a.length===10?`${a}T23:59:59.999Z`:a;n=n.lte("created_at",_)}const{data:l,error:g}=await n;if(g)return console.error("[getTotalKettlebellPoints] Error getting total kettlebell points:",g),0;const h=(l==null?void 0:l.reduce((_,r)=>_+r.points,0))||0;return console.log("[getTotalKettlebellPoints] Total points calculated:",h,"from",(l==null?void 0:l.length)||0,"records"),h}catch(n){return console.error("[getTotalKettlebellPoints] Exception getting total kettlebell points:",n),0}},Ne=async(o,a)=>{try{console.log("[getKettlebellPointsSummary] Starting to fetch kettlebell points...");let n=N.from("user_kettlebell_points").select(`
        user_id,
        points,
        created_at,
        user_profiles!user_kettlebell_points_user_id_fkey(
          first_name,
          last_name,
          email
        )
      `).order("created_at",{ascending:!1});if(o&&(n=n.gte("created_at",o)),a){const r=a.length===10?`${a}T23:59:59.999Z`:a;n=n.lte("created_at",r)}const{data:l,error:g}=await n;if(g)return console.error("[getKettlebellPointsSummary] Error getting kettlebell points summary:",g),[];if(console.log("[getKettlebellPointsSummary] Raw data received:",(l==null?void 0:l.length)||0,"records"),console.log("[getKettlebellPointsSummary] Sample data:",l==null?void 0:l.slice(0,2)),!l||l.length===0)return console.log("[getKettlebellPointsSummary] No data found, returning empty array"),[];const h=new Map;l.forEach(r=>{const v=r.user_id,w=r.user_profiles;h.has(v)||h.set(v,{user_id:v,user_name:w?`${w.first_name||""} ${w.last_name||""}`.trim():`User ${v.slice(0,8)}`,user_email:(w==null?void 0:w.email)||"No email",total_points:0,points_count:0,last_updated:r.created_at});const T=h.get(v);T.total_points+=r.points,T.points_count+=1,new Date(r.created_at)>new Date(T.last_updated)&&(T.last_updated=r.created_at)});const _=Array.from(h.values()).sort((r,v)=>v.total_points-r.total_points);return console.log("[getKettlebellPointsSummary] Processed summary:",_),_}catch(n){return console.error("[getKettlebellPointsSummary] Exception getting kettlebell points summary:",n),[]}},we=async o=>{try{const{data:a,error:n}=await N.from("user_kettlebell_points").select("*").eq("user_id",o).order("created_at",{ascending:!1});return n?(console.error("Error getting user kettlebell points:",n),[]):a||[]}catch(a){return console.error("Exception getting user kettlebell points:",a),[]}},ke=async(o,a,n)=>{try{console.log("[saveProgramApprovalState] Saving approval state:",{userId:o,approvalStatus:a,options:n});const{data:l,error:g}=await N.from("program_approval_states").insert({user_id:o,program_id:n.programId,approval_status:a,old_members_used:n.oldMembersUsed||!1,kettlebell_points:n.kettlebellPoints??0,cash_amount:n.cashAmount??0,pos_amount:n.posAmount??0,created_by:n.createdBy,notes:n.notes,group_room_size:n.groupRoomSize,weekly_frequency:n.weeklyFrequency,monthly_total:n.monthlyTotal}).select().single();return g?(console.error("[saveProgramApprovalState] Error saving approval state:",g),!1):(console.log("[saveProgramApprovalState] Approval state saved successfully:",l),!0)}catch(l){return console.error("[saveProgramApprovalState] Exception saving approval state:",l),!1}};export{xe as G,pe as P,ne as T,ye as a,_e as b,ve as c,Ne as d,ue as e,we as f,fe as g,je as h,ke as i,be as m,he as s};
